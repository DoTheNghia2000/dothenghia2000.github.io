<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
   <div id="video" width="640" height="480"></div>
   <div id="result"></div>

   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/quagga/dist/quagga.min.js"></script>
   <script>

      // Định nghĩa cấu hình cho QuaggaJS
      const config = {
         inputStream: {
            name: "Live",
            type: "LiveStream",
            target: document.querySelector("#video"),
            constraints: {
               facingMode: "environment"
            }
         },
         decoder: {
            readers: ["ean_reader"]
         }
      };

      // Khởi tạo QuaggaJS với cấu hình đã định nghĩa
      Quagga.init(config, function (err) {
         if (err) {
            console.log(err);
            return;
         }
         
         // Bắt đầu quét mã vạch khi QuaggaJS đã sẵn sàng
         Quagga.start();
         // Hiển thị khung quét mã vạch
         Quagga.onProcessed(function(result) {
            var drawingCtx = Quagga.canvas.ctx.overlay;
            var drawingCanvas = Quagga.canvas.dom.overlay;
            drawingCtx.clearRect(0, 0, parseInt(drawingCanvas.getAttribute("width")), parseInt(drawingCanvas.getAttribute("height")));
            if (result) {
               if (result.boxes) {
                  drawingCtx.strokeStyle = "#f00";
                  result.boxes.forEach(function (box) {
                     drawingCtx.strokeRect(box.x, box.y, box.width, box.height);
                  });
               }
               if (result.codeResult && result.codeResult.code) {
                  console.log(result.codeResult.code);
               }
            }
         });
      });
      
      // Xử lý sự kiện khi QuaggaJS nhận được kết quả quét
      Quagga.onDetected(function (result) {
         // Lấy nội dung được quét và hiển thị lên trang web
         const code = result.codeResult.code;
         document.querySelector("#result").textContent = code;

         // Tạm dừng QuaggaJS để ngừng quét sau khi tìm thấy một mã vạch
         Quagga.stop();
      });


   </script>
</body>

</html>
